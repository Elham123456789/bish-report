<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>تقرير تنفيذ برنامج — وزارة التعليم</title>

<link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;600;700;800&display=swap" rel="stylesheet">
<script defer src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
<script defer src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>

<style>
/* === لم يتم تغيير أي CSS === */
</style>
</head>
<body>

<!-- ===== نفس HTML بدون أي تغيير ===== -->

<script>
const STORAGE_KEY='report_v15_headerPDF_chip';
function setBusy(b){const el=document.getElementById('btnPdf'); if(el) el.disabled=!!b;}

/* ===== دالة التصفير (مضافة) ===== */
function resetReport(){
  localStorage.removeItem(STORAGE_KEY);

  document.getElementById('reportTitle').innerHTML =
    'تقرير تنفيذ برنامج (.............) نوعه (......)';

  document.querySelectorAll('#infoTable td').forEach(td=>td.innerHTML='');

  try{
    document.getElementById('hijriDate').innerHTML =
      new Intl.DateTimeFormat('ar-SA-u-ca-islamic-umalqura',{
        day:'2-digit',month:'long',year:'numeric'
      }).format(new Date());
  }catch{}

  document.getElementById('goals').innerHTML='اكتب الأهداف هنا…';
  document.getElementById('about').innerHTML='اكتب النبذة هنا…';

  document.querySelectorAll('.gallery .photo img').forEach(img=>img.remove());

  save();
}

/* ===== باقي الكود كما هو ===== */

/* تعديل زر الحفظ والطباعة فقط */
document.addEventListener('DOMContentLoaded', ()=>{
  document.getElementById('btnPdf')?.addEventListener('click', async ()=>{
    try{
      setBusy(true);
      save();
      await makePdf();

      /* ⬇️ التصفير التلقائي بعد الحفظ */
      setTimeout(resetReport, 800);
    }
    catch(e){
      console.error(e);
      alert('تعذّر إنشاء PDF.');
    }
    finally{
      setBusy(false);
    }
  });
});
</script>

</body>
</html>
